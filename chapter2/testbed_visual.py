import matplotlib.pyplot as plt
import numpy as np
import random

def run():
    
    # Page 29, Section 2.3, The 10-armed Testbed, Introduction to Reinforcement Learning

    # Compares a greedy method with two epsilon-greedy methods (epsilon= 0.01 and epsilon= 0.1),
    # as described above, on the 10-armed testbed. All the methods formed their action-value 
    # estimates using the sample-average technique.

    print('testbed_visual_git.run: steps = 1000')
    x = np.arange(1, 1001)
    with open('./data/average_reward_runs2000_steps1000_epsilon01.npy', 'rb') as f:
        average_reward_steps1000_epsilon01 = np.load(f)
    with open('./data/average_reward_runs2000_steps1000_epsilon001.npy', 'rb') as f:
        average_reward_steps1000_epsilon001 = np.load(f)
    with open('./data/average_reward_runs2000_steps1000_epsilon00.npy', 'rb') as f:
        average_reward_steps1000_epsilon00 = np.load(f)
    print('testbed.run: average_reward_steps1000_epsilon01[-1] = {0}'.format(average_reward_steps1000_epsilon01[-1]))
    print('testbed.run: average_reward_steps1000_epsilon001[-1] = {0}'.format(average_reward_steps1000_epsilon001[-1]))
    print('testbed.run: average_reward_steps1000_epsilon00[-1] = {0}'.format(average_reward_steps1000_epsilon00[-1]))
    fig, ax = plt.subplots()
    ax.plot(x, average_reward_steps1000_epsilon01, label='eps = 0.1')
    ax.plot(x, average_reward_steps1000_epsilon001, label='eps = 0.01')
    ax.plot(x, average_reward_steps1000_epsilon00, label='greedy')
    ax.set_xlabel('Steps')
    ax.set_ylabel('Average Reward')
    ax.set_title("Average Reward vs. Time (1000 Steps)")
    ax.legend()
    plt.savefig('./plots/average_reward_runs2000_steps1000.png')
    plt.show()
    fig, ax = plt.subplots()
    cum_average_reward_steps1000_epsilon01 = np.cumsum(average_reward_steps1000_epsilon01)
    cum_average_reward_steps1000_epsilon001 = np.cumsum(average_reward_steps1000_epsilon001)
    cum_average_reward_steps1000_epsilon00 = np.cumsum(average_reward_steps1000_epsilon00)
    print('testbed.run: cum_average_reward_steps1000_epsilon01[-1] = {0}'.format(cum_average_reward_steps1000_epsilon01[-1]))
    print('testbed.run: cum_average_reward_steps1000_epsilon001[-1] = {0}'.format(cum_average_reward_steps1000_epsilon001[-1]))
    print('testbed.run: cum_average_reward_steps1000_epsilon00[-1] = {0}'.format(cum_average_reward_steps1000_epsilon00[-1]))
    ax.plot(x, cum_average_reward_steps1000_epsilon01, label='eps = 0.1')
    ax.plot(x, cum_average_reward_steps1000_epsilon001, label='eps = 0.01')
    ax.plot(x, cum_average_reward_steps1000_epsilon00, label='greedy')
    ax.set_xlabel('Steps')
    ax.set_ylabel('Cum Ave Reward')
    ax.set_title("Cumulative Average Reward vs. Time (1000 Steps)")
    ax.legend()
    plt.savefig('./plots/cumulative_average_reward_runs2000_steps1000.png')
    plt.show()
    with open('./data/prob_a_star_runs2000_steps1000_epsilon01.npy', 'rb') as f:
        prob_a_star_steps1000_epsilon01 = np.load(f)
    with open('./data/prob_a_star_runs2000_steps1000_epsilon001.npy', 'rb') as f:
        prob_a_star_steps1000_epsilon001 = np.load(f)
    with open('./data/prob_a_star_runs2000_steps1000_epsilon00.npy', 'rb') as f:
        prob_a_star_steps1000_epsilon00 = np.load(f)
    print('testbed.run: prob_a_star_steps1000_epsilon01[-1] = {0}'.format(prob_a_star_steps1000_epsilon01[-1]))
    print('testbed.run: prob_a_star_steps1000_epsilon001[-1] = {0}'.format(prob_a_star_steps1000_epsilon001[-1]))
    print('testbed.run: prob_a_star_steps1000_epsilon00[-1] = {0}'.format(prob_a_star_steps1000_epsilon00[-1]))
    fig, ax = plt.subplots()
    ax.plot(x, prob_a_star_steps1000_epsilon01, label='eps = 0.1')
    ax.plot(x, prob_a_star_steps1000_epsilon001, label='eps = 0.01')
    ax.plot(x, prob_a_star_steps1000_epsilon00, label='greedy')
    ax.set_xlabel('Steps')
    ax.set_ylabel('Prob A*')
    ax.set_title("Prob A* vs. Time (1000 Steps)")
    ax.legend()
    plt.savefig('./plots/prob_a_star_runs2000_steps1000.png')
    plt.show()

    print('testbed.run: steps = 10000')
    x = np.arange(1, 10001)
    with open('./data/average_reward_runs2000_steps10000_epsilon01.npy', 'rb') as f:
        average_reward_steps10000_epsilon01 = np.load(f)
    with open('./data/average_reward_runs2000_steps10000_epsilon001.npy', 'rb') as f:
        average_reward_steps10000_epsilon001 = np.load(f)
    with open('./data/average_reward_runs2000_steps10000_epsilon00.npy', 'rb') as f:
        average_reward_steps10000_epsilon00 = np.load(f)
    print('testbed.run: average_reward_steps10000_epsilon01[-1] = {0}'.format(average_reward_steps10000_epsilon01[-1]))
    print('testbed.run: average_reward_steps10000_epsilon001[-1] = {0}'.format(average_reward_steps10000_epsilon001[-1]))
    print('testbed.run: average_reward_steps10000_epsilon00[-1] = {0}'.format(average_reward_steps10000_epsilon00[-1]))
    fig, ax = plt.subplots()
    ax.plot(x, average_reward_steps10000_epsilon01, label='eps = 0.1')
    ax.plot(x, average_reward_steps10000_epsilon001, label='eps = 0.01')
    ax.plot(x, average_reward_steps10000_epsilon00, label='greedy')
    ax.set_xlabel('Steps')
    ax.set_ylabel('Average Reward')
    ax.set_title("Average Reward vs. Time (10000 Steps)")
    ax.legend()
    plt.savefig('./plots/average_reward_runs2000_steps10000.png')
    plt.show()
    fig, ax = plt.subplots()
    cum_average_reward_steps10000_epsilon01 = np.cumsum(average_reward_steps10000_epsilon01)
    cum_average_reward_steps10000_epsilon001 = np.cumsum(average_reward_steps10000_epsilon001)
    cum_average_reward_steps10000_epsilon00 = np.cumsum(average_reward_steps10000_epsilon00)
    print('testbed.run: cum_average_reward_steps10000_epsilon01[-1] = {0}'.format(cum_average_reward_steps10000_epsilon01[-1]))
    print('testbed.run: cum_average_reward_steps10000_epsilon001[-1] = {0}'.format(cum_average_reward_steps10000_epsilon001[-1]))
    print('testbed.run: cum_average_reward_steps10000_epsilon00[-1] = {0}'.format(cum_average_reward_steps10000_epsilon00[-1]))
    ax.plot(x, cum_average_reward_steps10000_epsilon01, label='eps = 0.1')
    ax.plot(x, cum_average_reward_steps10000_epsilon001, label='eps = 0.01')
    ax.plot(x, cum_average_reward_steps10000_epsilon00, label='greedy')
    ax.set_xlabel('Steps')
    ax.set_ylabel('Cum Ave Reward')
    ax.set_title("Cumulative Average Reward vs. Time (10000 Steps)")
    ax.legend()
    plt.savefig('./plots/cumulative_average_reward_runs2000_steps10000.png')
    plt.show()
    with open('./data/prob_a_star_runs2000_steps10000_epsilon01.npy', 'rb') as f:
        prob_a_star_steps10000_epsilon01 = np.load(f)
    with open('./data/prob_a_star_runs2000_steps10000_epsilon001.npy', 'rb') as f:
        prob_a_star_steps10000_epsilon001 = np.load(f)
    with open('./data/prob_a_star_runs2000_steps10000_epsilon00.npy', 'rb') as f:
        prob_a_star_steps10000_epsilon00 = np.load(f)
    print('testbed.run: prob_a_star_steps10000_epsilon01[-1] = {0}'.format(prob_a_star_steps10000_epsilon01[-1]))
    print('testbed.run: prob_a_star_steps10000_epsilon001[-1] = {0}'.format(prob_a_star_steps10000_epsilon001[-1]))
    print('testbed.run: prob_a_star_steps10000_epsilon00[-1] = {0}'.format(prob_a_star_steps10000_epsilon00[-1]))
    fig, ax = plt.subplots()
    ax.plot(x, prob_a_star_steps10000_epsilon01, label='eps = 0.1')
    ax.plot(x, prob_a_star_steps10000_epsilon001, label='eps = 0.01')
    ax.plot(x, prob_a_star_steps10000_epsilon00, label='greedy')
    ax.set_xlabel('Steps')
    ax.set_ylabel('Prob A*')
    ax.set_title("Prob A* vs. Time (10000 Steps)")
    ax.legend()
    plt.savefig('./plots/prob_a_star_runs2000_steps10000.png')
    plt.show()

    print('testbed.run: steps = 20000')
    x = np.arange(1, 20001)
    with open('./data/average_reward_runs2000_steps20000_epsilon01.npy', 'rb') as f:
        average_reward_steps20000_epsilon01 = np.load(f)
    with open('./data/average_reward_runs2000_steps20000_epsilon001.npy', 'rb') as f:
        average_reward_steps20000_epsilon001 = np.load(f)
    with open('./data/average_reward_runs2000_steps20000_epsilon00.npy', 'rb') as f:
        average_reward_steps20000_epsilon00 = np.load(f)
    print('testbed.run: average_reward_steps20000_epsilon01[-1] = {0}'.format(average_reward_steps20000_epsilon01[-1]))
    print('testbed.run: average_reward_steps20000_epsilon001[-1] = {0}'.format(average_reward_steps20000_epsilon001[-1]))
    print('testbed.run: average_reward_steps20000_epsilon00[-1] = {0}'.format(average_reward_steps20000_epsilon00[-1]))
    fig, ax = plt.subplots()
    ax.plot(x, average_reward_steps20000_epsilon01, label='eps = 0.1')
    ax.plot(x, average_reward_steps20000_epsilon001, label='eps = 0.01')
    ax.plot(x, average_reward_steps20000_epsilon00, label='greedy')
    ax.set_xlabel('Steps')
    ax.set_ylabel('Average Reward')
    ax.set_title("Average Reward vs. Time (20000 Steps)")
    ax.legend()
    plt.savefig('./plots/average_reward_runs2000_steps20000.png')
    plt.show()
    fig, ax = plt.subplots()
    cum_average_reward_steps20000_epsilon01 = np.cumsum(average_reward_steps20000_epsilon01)
    cum_average_reward_steps20000_epsilon001 = np.cumsum(average_reward_steps20000_epsilon001)
    cum_average_reward_steps20000_epsilon00 = np.cumsum(average_reward_steps20000_epsilon00)
    print('testbed.run: cum_average_reward_steps20000_epsilon01[-1] = {0}'.format(cum_average_reward_steps20000_epsilon01[-1]))
    print('testbed.run: cum_average_reward_steps20000_epsilon001[-1] = {0}'.format(cum_average_reward_steps20000_epsilon001[-1]))
    print('testbed.run: cum_average_reward_steps20000_epsilon00[-1] = {0}'.format(cum_average_reward_steps20000_epsilon00[-1]))
    ax.plot(x, cum_average_reward_steps20000_epsilon01, label='eps = 0.1')
    ax.plot(x, cum_average_reward_steps20000_epsilon001, label='eps = 0.01')
    ax.plot(x, cum_average_reward_steps20000_epsilon00, label='greedy')
    ax.set_xlabel('Steps')
    ax.set_ylabel('Cum Ave Reward')
    ax.set_title("Cumulative Average Reward vs. Time (20000 Steps)")
    ax.legend()
    plt.savefig('./plots/cumulative_average_reward_runs2000_steps20000.png')
    plt.show()
    with open('./data/prob_a_star_runs2000_steps20000_epsilon01.npy', 'rb') as f:
        prob_a_star_steps20000_epsilon01 = np.load(f)
    with open('./data/prob_a_star_runs2000_steps20000_epsilon001.npy', 'rb') as f:
        prob_a_star_steps20000_epsilon001 = np.load(f)
    with open('./data/prob_a_star_runs2000_steps20000_epsilon00.npy', 'rb') as f:
        prob_a_star_steps20000_epsilon00 = np.load(f)
    print('testbed.run: prob_a_star_steps20000_epsilon01[-1] = {0}'.format(prob_a_star_steps20000_epsilon01[-1]))
    print('testbed.run: prob_a_star_steps20000_epsilon001[-1] = {0}'.format(prob_a_star_steps20000_epsilon001[-1]))
    print('testbed.run: prob_a_star_steps20000_epsilon00[-1] = {0}'.format(prob_a_star_steps20000_epsilon00[-1]))
    fig, ax = plt.subplots()
    ax.plot(x, prob_a_star_steps20000_epsilon01, label='eps = 0.1')
    ax.plot(x, prob_a_star_steps20000_epsilon001, label='eps = 0.01')
    ax.plot(x, prob_a_star_steps20000_epsilon00, label='greedy')
    ax.set_xlabel('Steps')
    ax.set_ylabel('Prob A*')
    ax.set_title("Prob A* vs. Time (20000 Steps)")
    ax.legend()
    plt.savefig('./plots/prob_a_star_runs2000_steps20000.png')
    plt.show()

if __name__ == '__main__':
    run()